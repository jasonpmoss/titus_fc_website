<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merch Store - TITUS Football Club</title>
    <link rel="stylesheet" href="../style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Oswald:wght@500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        /* --- STYLES FOR THE MERCH PAGE --- */
        .merch-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .merch-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid #eee;
        }

        .merch-header {
            text-align: center;
            margin-bottom: 15px;
            border-bottom: 2px solid #f4f4f4;
            padding-bottom: 10px;
        }

        .price-tag {
            font-size: 1.2rem;
            color: var(--navy);
            font-weight: bold;
            font-family: 'Oswald', sans-serif;
            display: block;
        }

        /* Kit Rows */
        .kit-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
            border-bottom: 1px dashed #eee;
            padding-bottom: 10px;
            flex-wrap: wrap;
        }

        .kit-label {
            width: 80px;
            font-weight: bold;
            font-size: 0.9rem;
            color: #555;
        }

        .form-control {
            flex: 1;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            min-width: 80px;
        }

        /* Specific style for printing inputs */
        .print-input {
            margin-top: 5px;
            background-color: #f9fbfd;
            border-color: #d1d9e6;
        }

        .order-summary {
            background: var(--navy);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }

        .total-display {
            font-size: 2rem;
            color: var(--gold);
            font-family: 'Oswald', sans-serif;
        }

        /* Success Message Styling */
        #success-message {
            display: none;
            text-align: center;
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            margin: 0 auto;
        }

        .bank-details-box {
            background: #f9f9f9;
            border-left: 5px solid var(--gold);
            padding: 20px;
            text-align: left;
            margin: 20px auto;
            max-width: 500px;
        }
    </style>
</head>

<body>

    <nav>
        <div class="container nav-flex">
            <a href="../index.html">
                <img src="../logo.png" alt="Titus Logo" class="nav-logo">
            </a>
            <ul class="nav-links">
                <li><a href="../index.html">Home</a></li>
                <li><a href="../register.html" class="btn-gold">Join Now</a></li>
            </ul>
        </div>
    </nav>

    <header class="section-light" style="padding-bottom: 20px;">
        <div class="container">
            <h1 class="text-navy">Club <span class="text-gold">Merchandise</span></h1>
            <p>Gear up for the season. Select your items below.</p>
        </div>
    </header>

    <section class="section-light" style="padding-top: 20px;">
        <div class="container">

            <div id="success-message">
                <i class="fa-solid fa-circle-check fa-4x" style="color: var(--gold); margin-bottom: 20px;"></i>
                <h2 class="text-navy">Order Received Successfully!</h2>
                <p>Thank you. We have received your merchandise order.</p>
                <p>Please make payment to the account below:</p>

                <div class="bank-details-box">
                    <h3 class="text-navy" style="margin-top:0;">Banking Details</h3>
                    <p><strong>Bank:</strong> FNB (First National Bank)</p>
                    <p><strong>Account Name:</strong> Titus Football Club</p>
                    <p><strong>Account Number:</strong> 63193435451</p>
                    <p><strong>Branch Code:</strong> 250655</p>
                    <p><strong>Reference:</strong> Child's Name + Merch</p>
                </div>

                <p style="font-size: 0.9rem; color: #666;">Please send proof of payment to accounts@titusfc.co.za</p>
                <br>
                <a href="../index.html" class="btn-gold">Return Home</a>
            </div>

            <form id="merch-form" name="submit-to-google-sheet">

                <div
                    style="background: white; padding: 25px; border-radius: 8px; margin-bottom: 30px; border-top: 4px solid var(--navy);">
                    <h3 class="text-navy">1. Your Details</h3>
                    <div class="contact-flex" style="gap: 20px;">
                        <input type="text" name="Parent Name" placeholder="Parent Name" required class="form-control">
                        <input type="text" name="Phone" placeholder="Phone Number" required class="form-control">
                        <input type="email" name="Email" placeholder="Email Address" required class="form-control">
                    </div>
                </div>

                <h3 class="text-navy">2. Select Items</h3>
                <div class="merch-grid">

                    <div class="merch-item">
                        <div class="merch-header">
                            <i class="fa-solid fa-shirt fa-2x" style="color:var(--red);"></i>
                            <h4>Player Kits</h4>
                            <span class="price-tag">R310 each</span>
                        </div>

                        <div class="kit-row">
                            <span class="kit-label">Home</span>
                            <select class="form-control item-select" data-name="Player Kit (Home)" data-price="310">
                                <option value="0">Qty</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                            </select>
                            <input type="text" class="form-control item-size" placeholder="Size (e.g. 10Y)">
                        </div>

                        <div class="kit-row">
                            <span class="kit-label">Away</span>
                            <select class="form-control item-select" data-name="Player Kit (Away)" data-price="310">
                                <option value="0">Qty</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                            </select>
                            <input type="text" class="form-control item-size" placeholder="Size">
                        </div>

                        <div class="kit-row" style="border-bottom: none;">
                            <span class="kit-label">Training</span>
                            <select class="form-control item-select" data-name="Player Kit (Training)" data-price="310">
                                <option value="0">Qty</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                            </select>
                            <input type="text" class="form-control item-size" placeholder="Size">
                        </div>
                    </div>

                    <div class="merch-item">
                        <div class="merch-header">
                            <i class="fa-solid fa-hands fa-2x" style="color:var(--navy);"></i>
                            <h4>Goalie Kits</h4>
                            <span class="price-tag">R310 each</span>
                        </div>

                        <div class="kit-row">
                            <span class="kit-label">Home</span>
                            <select class="form-control item-select" data-name="Goalie Kit (Home)" data-price="310">
                                <option value="0">Qty</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                            </select>
                            <input type="text" class="form-control item-size" placeholder="Size">
                        </div>

                        <div class="kit-row" style="border-bottom: none;">
                            <span class="kit-label">Away</span>
                            <select class="form-control item-select" data-name="Goalie Kit (Away)" data-price="310">
                                <option value="0">Qty</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                            </select>
                            <input type="text" class="form-control item-size" placeholder="Size">
                        </div>
                    </div>

                    <div class="merch-item">
                        <div class="merch-header">
                            <i class="fa-solid fa-person-running fa-2x" style="color:var(--navy);"></i>
                            <h4>Official Tracksuit</h4>
                            <span class="price-tag">R660</span>
                        </div>
                        <div class="kit-row" style="border:none;">
                            <span class="kit-label">Set</span>
                            <select class="form-control item-select" data-name="Tracksuit" data-price="660">
                                <option value="0">Qty</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>
                            <input type="text" class="form-control item-size" placeholder="Size">
                        </div>
                    </div>

                    <div class="merch-item">
                        <div class="merch-header">
                            <i class="fa-solid fa-bag-shopping fa-2x" style="color:#333;"></i>
                            <h4>Accessories</h4>
                        </div>
                        <div class="kit-row">
                            <span class="kit-label">Bag</span>
                            <select class="form-control item-select" data-name="Club Bag" data-price="300">
                                <option value="0">Qty</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                            </select>
                            <span style="font-weight:bold; color:var(--navy); margin-left:5px;">R300</span>
                        </div>
                        <div class="kit-row" style="border:none;">
                            <span class="kit-label">Bottle</span>
                            <select class="form-control item-select" data-name="Water Bottle" data-price="180">
                                <option value="0">Qty</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                            </select>
                            <span style="font-weight:bold; color:var(--navy); margin-left:5px;">R180</span>
                        </div>
                    </div>

                    <div class="merch-item" style="border: 2px solid var(--gold);">
                        <div class="merch-header">
                            <i class="fa-solid fa-users-shirt fa-2x" style="color:var(--gold);"></i>
                            <h4>Supporters Jersey</h4>
                            <span class="price-tag">R460</span>
                        </div>
                        <p style="font-size: 0.8rem; color: #666; margin-bottom: 10px;">Includes custom Name & Number
                            printing.</p>

                        <div class="kit-row">
                            <span class="kit-label">Custom</span>
                            <select class="form-control item-select" data-name="Supporters Jersey" data-price="460">
                                <option value="0">Qty</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>
                            <input type="text" class="form-control item-size" placeholder="Size (S, M, L, XL)">

                            <div style="width: 100%; display: flex; gap: 5px;">
                                <input type="text" class="form-control print-input item-print-name"
                                    placeholder="Name to Print (e.g. SMITH)">
                                <input type="text" class="form-control print-input item-print-number" placeholder="No."
                                    style="max-width: 60px;">
                            </div>
                        </div>
                    </div>

                </div>

                <div class="order-summary">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 300px; margin-bottom: 20px;">
                            <h3 style="margin-bottom: 10px; color: var(--gold);">Payment Info</h3>
                            <p>Once you click "Place Order", your request will be recorded.</p>
                            <p>Banking details will be shown on the next screen.</p>
                        </div>
                        <div style="text-align: right; flex: 1; min-width: 300px;">
                            <h3>Total Estimated Cost</h3>
                            <div class="total-display">R<span id="grand-total">0</span></div>
                            <br>
                            <button type="submit" class="btn-gold-full" id="submit-btn" style="max-width: 300px;">PLACE
                                ORDER</button>
                        </div>
                    </div>
                </div>

                <input type="hidden" name="Items Ordered" id="hidden-items">
                <input type="hidden" name="Total" id="hidden-total">
                <input type="hidden" name="Status" value="New">

            </form>
        </div>
    </section>

    <footer>
        <div class="container">
            <p>&copy; 2026 Titus Football Club. All Rights Reserved. (v1.1)</p>
        </div>
    </footer>

    <script>
        // --- CONFIGURATION ---
        // PASTE YOUR GOOGLE SCRIPT URL BELOW
        const scriptURL = 'https://script.google.com/macros/s/AKfycbxVUvWRDUD9SU6GbhRa7dfopzfoyCwK9_uqDiqDD5A1JklMlhQ4bXdg-NCaE7FDlFCkmQ/exec';
        // ---------------------

        const selects = document.querySelectorAll('.item-select');
        const totalDisplay = document.getElementById('grand-total');
        const hiddenTotal = document.getElementById('hidden-total');
        const hiddenItems = document.getElementById('hidden-items');

        function updateTotals() {
            let total = 0;
            let itemsSummary = [];

            selects.forEach(select => {
                const qty = parseInt(select.value);
                if (qty > 0) {
                    const price = parseInt(select.dataset.price);
                    const name = select.dataset.name;

                    // Find container row
                    const row = select.closest('.kit-row');

                    // Get Size
                    const sizeInput = row ? row.querySelector('.item-size') : null;
                    const sizeStr = (sizeInput && sizeInput.value) ? `[Size: ${sizeInput.value}]` : '';

                    // Get Printing Info (Name)
                    const printNameInput = row ? row.querySelector('.item-print-name') : null;
                    const printNameStr = (printNameInput && printNameInput.value) ? `[Print Name: ${printNameInput.value}]` : '';

                    // Get Printing Info (Number)
                    const printNumInput = row ? row.querySelector('.item-print-number') : null;
                    const printNumStr = (printNumInput && printNumInput.value) ? `[Print No: ${printNumInput.value}]` : '';

                    total += (qty * price);
                    itemsSummary.push(`${qty} x ${name} ${sizeStr} ${printNameStr} ${printNumStr}`);
                }
            });

            totalDisplay.innerText = total;
            hiddenTotal.value = total;
            hiddenItems.value = itemsSummary.join(", ");
        }

        // Add Listeners to all inputs that affect the order
        selects.forEach(s => s.addEventListener('change', updateTotals));
        document.querySelectorAll('.item-size').forEach(i => i.addEventListener('input', updateTotals));
        document.querySelectorAll('.item-print-name').forEach(i => i.addEventListener('input', updateTotals));
        document.querySelectorAll('.item-print-number').forEach(i => i.addEventListener('input', updateTotals));

        // Submit Logic
        const form = document.forms['submit-to-google-sheet'];
        const btn = document.getElementById('submit-btn');

        form.addEventListener('submit', e => {
            e.preventDefault();
            btn.disabled = true;
            btn.innerText = "Processing...";
            updateTotals();

            // DEBUG: Check what is being sent
            const debugTotal = document.getElementById('hidden-total').value;
            alert("Debug Check: The Total value being sent is: " + debugTotal);

            fetch(scriptURL, { method: 'POST', body: new FormData(form) })
                .then(response => {
                    document.getElementById('merch-form').style.display = 'none';
                    document.getElementById('success-message').style.display = 'block';
                    window.scrollTo(0, 0);
                })
                .catch(error => {
                    console.error('Error!', error.message);
                    alert("Something went wrong. Please check your internet connection.");
                    btn.disabled = false;
                    btn.innerText = "PLACE ORDER";
                });
        });
    </script>

</body>

</html>